{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\USUARIO\\\\Documents\\\\Aplicaciones\\\\MERN\\\\gempro\\\\cliente\\\\src\\\\AuthProvider.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { createContext, useContext, useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useCarrito } from \"./context/CarritoContext\";\nimport { authApi } from \"./common\";\nimport toastr from 'toastr';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nconst AuthProvider = ({\n  children\n}) => {\n  _s();\n  const [user, setUser] = useState(null);\n  const [token, setToken] = useState(localStorage.getItem(\"site\") || \"\");\n  const navigate = useNavigate();\n  const {\n    limpiarCarrito\n  } = useCarrito();\n  const loginAction = async userFrm => {\n    try {\n      const response = await fetch(authApi.login.url, {\n        method: authApi.login.method,\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(userFrm)\n      });\n      const data = await response.json();\n      if (response.ok) {\n        setUser(data.user);\n        setToken(data.token);\n        localStorage.setItem(\"site\", data.token);\n        navigate(\"/dashboard\");\n        return {\n          success: true,\n          message: data.message\n        };\n      } else if (response.status === 500 || response.status === 400) {\n        return {\n          error: data.error\n        };\n      } else {\n        logOut();\n        toastr.error(data.error);\n      }\n    } catch (error) {\n      return {\n        success: false,\n        error: 'Error al iniciar sesión'\n      };\n    }\n  };\n  const logOut = () => {\n    setUser(null);\n    setToken(\"\");\n    localStorage.removeItem(\"site\");\n    limpiarCarrito();\n    navigate(\"/dashboard\");\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user,\n      setUser,\n      token,\n      loginAction,\n      logOut\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 54,\n    columnNumber: 5\n  }, this);\n};\n_s(AuthProvider, \"g8xScBU6m4JvfgYyG6QRFD5JU7E=\", false, function () {\n  return [useNavigate, useCarrito];\n});\n_c = AuthProvider;\nexport default AuthProvider;\n\n// Hook personalizado\nexport const useAuth = () => {\n  _s2();\n  return useContext(AuthContext);\n};\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["createContext","useContext","useState","useNavigate","useCarrito","authApi","toastr","jsxDEV","_jsxDEV","AuthContext","AuthProvider","children","_s","user","setUser","token","setToken","localStorage","getItem","navigate","limpiarCarrito","loginAction","userFrm","response","fetch","login","url","method","headers","body","JSON","stringify","data","json","ok","setItem","success","message","status","error","logOut","removeItem","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useAuth","_s2","$RefreshReg$"],"sources":["C:/Users/USUARIO/Documents/Aplicaciones/MERN/gempro/cliente/src/AuthProvider.js"],"sourcesContent":["import { createContext, useContext, useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useCarrito } from \"./context/CarritoContext\";\nimport { authApi } from \"./common\";\nimport toastr from 'toastr';\n\nconst AuthContext = createContext();\n\nconst AuthProvider = ({ children }) => {\n\n    const [user, setUser] = useState(null);\n    const [token, setToken] = useState(localStorage.getItem(\"site\") || \"\");\n    const navigate = useNavigate();\n    const { limpiarCarrito } = useCarrito();\n\n    const loginAction = async (userFrm) => {\n        try {\n            const response = await fetch(authApi.login.url, {\n                method: authApi.login.method,\n              headers: {\n                \"Content-Type\": \"application/json\",\n              },\n              body: JSON.stringify(userFrm),\n            });\n\n            const data = await response.json();\n\n            if (response.ok) {\n                setUser(data.user);\n                setToken(data.token);\n                localStorage.setItem(\"site\", data.token);\n                navigate(\"/dashboard\");\n                return { success: true, message: data.message };\n            } else if (response.status === 500 || response.status === 400) {\n                return {error: data.error}\n            } else {\n                logOut();\n                toastr.error(data.error);\n            }\n        } catch (error) {\n            return { success: false, error: 'Error al iniciar sesión' };\n        }\n    }\n\n  const logOut = () => {\n    setUser(null);\n    setToken(\"\");\n    localStorage.removeItem(\"site\");\n    limpiarCarrito();\n    navigate(\"/dashboard\");\n  };\n\n  return (\n    <AuthContext.Provider value={{ user, setUser, token, loginAction, logOut }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport default AuthProvider;\n\n// Hook personalizado\nexport const useAuth = () => {\n  return useContext(AuthContext);\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}